name: Develop to Main ë¸Œëœì¹˜ ë™ê¸°í™”

on:
  schedule:
    - cron: '0 16 * * *'  # UTC 16:00 = KST 01:00
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

permissions:
  contents: write
  pull-requests: write

jobs:
  develop-to-main:
    runs-on: ubuntu-latest
    steps:
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Git ì„¤ì •
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Develop ë¸Œëœì¹˜ ë³€ê²½ì‚¬í•­ í™•ì¸ ë° ë™ê¸°í™”
        run: |
          # develop ë¸Œëœì¹˜ì˜ ìƒˆë¡œìš´ ì»¤ë°‹ í™•ì¸ (ì§€ë‚œ 24ì‹œê°„)
          NEW_COMMITS=$(git log --since="@{24 hours ago}" --format="%H" develop)
          
          if [ ! -z "$NEW_COMMITS" ]; then
            echo "âœ¨ develop ë¸Œëœì¹˜ì— ìƒˆë¡œìš´ ì»¤ë°‹ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤."
          
            # main ë¸Œëœì¹˜ë¡œ ì „í™˜ ë° ìµœì‹ í™”
            git checkout main
            git pull origin main
          
            # developì˜ ë³€ê²½ì‚¬í•­ì„ mainìœ¼ë¡œ ë¨¸ì§€
            git merge develop --no-ff -m "ğŸ”„ develop â†’ main ìë™ ë™ê¸°í™”"
          
            # ë³€ê²½ì‚¬í•­ í‘¸ì‹œ
            git push origin main
          
            echo "âœ… main ë¸Œëœì¹˜ ë™ê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
          else
            echo "ğŸ’¡ develop ë¸Œëœì¹˜ì— ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
          fi

      - name: ì‹¤íŒ¨ ì‹œ ì•Œë¦¼
        if: failure()
#        env:
#          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
#          uses: Ilshidur/action-discord@master
#          with:
#            args: |
#              ğŸš¨ **ë¸Œëœì¹˜ ë™ê¸°í™” ì‹¤íŒ¨ ì•Œë¦¼**
#
#              **ì €ì¥ì†Œ:** ${{ github.repository }}
#              **ì›Œí¬í”Œë¡œìš°:** ${{ github.workflow }}
#              **ì‹¤í–‰ì:** ${{ github.actor }}
#              **ì‹¤í–‰ ì‹œê°„:** ${{ github.event.schedule }}
#
#              **ìƒì„¸ ì •ë³´:**
#              - ì‘ì—… URL: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
#
#              ë¹ ë¥¸ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤! ğŸ”
        run: |
          echo "âŒ ë¸Œëœì¹˜ ë™ê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
          exit 1